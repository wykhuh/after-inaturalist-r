<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Working with data – iNaturalist CNC</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
// https://stackoverflow.com/questions/76119872/quarto-website-make-template-for-javascript-button-show-answer

  function addAnswerWithButton(answerClass, buttonText, answerText) {

    const divElement = document.querySelector(`.${answerClass}`);
    const randomId = "answer-" + Math.floor(Math.random() * 1000000);

    // Create the new button element
    const buttonElement = document.createElement("button");
    buttonElement.className = "btn btn-primary show-answer";
    buttonElement.textContent = 'Show solution';
    buttonElement.onclick = function() {
      showAnswer(randomId);
    };

    // Create the new answer element
    const answerElement = document.createElement("div");
    answerElement.id = randomId;
    answerElement.style.display = "none";
    answerElement.innerHTML = answerText;

    // Replace the div element with the new button and answer elements
    divElement.parentNode.replaceChild(buttonElement, divElement);
    buttonElement.insertAdjacentElement("afterend", answerElement);
  }

  function showAnswer(answerId) {
    var answer = document.getElementById(answerId);
    if (answer.style.display === "none") {
      answer.style.display = "block";
    } else {
      answer.style.display = "none";
    }
  }

  function addAnswerButton() {
    var answers = document.querySelectorAll(".answer")
    answers.forEach(e => {
      addAnswerWithButton("answer", " Show solution", e.innerHTML);
    });
  }

  window.document.addEventListener("DOMContentLoaded", function (event) {
    addAnswerButton();
  });
</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">iNaturalist CNC</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../lessons/working-with-data.html">Working with data</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/intro-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Data Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/intro-r-rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to R and RStudio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/working-with-data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Working with data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/creating-maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creating maps</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/creating-charts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creating charts</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/other_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using to other datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/next-steps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Next steps</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#coding-concepts" id="toc-coding-concepts" class="nav-link active" data-scroll-target="#coding-concepts">Coding Concepts</a>
  <ul class="collapse">
  <li><a href="#file-paths" id="toc-file-paths" class="nav-link" data-scroll-target="#file-paths">File paths</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a></li>
  <li><a href="#r-packages" id="toc-r-packages" class="nav-link" data-scroll-target="#r-packages">R packages</a></li>
  </ul></li>
  <li><a href="#importing-inaturalist-data" id="toc-importing-inaturalist-data" class="nav-link" data-scroll-target="#importing-inaturalist-data">Importing iNaturalist data</a>
  <ul class="collapse">
  <li><a href="#reading-a-file" id="toc-reading-a-file" class="nav-link" data-scroll-target="#reading-a-file">Reading a file</a></li>
  </ul></li>
  <li><a href="#the-data.frame" id="toc-the-data.frame" class="nav-link" data-scroll-target="#the-data.frame">The data.frame</a></li>
  <li><a href="#manipulating-data" id="toc-manipulating-data" class="nav-link" data-scroll-target="#manipulating-data">Manipulating data</a>
  <ul class="collapse">
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select">select()</a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter">filter()</a></li>
  <li><a href="#the-pipe" id="toc-the-pipe" class="nav-link" data-scroll-target="#the-pipe">The pipe: %&gt;%</a></li>
  </ul></li>
  <li><a href="#errors-in-code" id="toc-errors-in-code" class="nav-link" data-scroll-target="#errors-in-code">Errors in code</a></li>
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise 1</a></li>
  <li><a href="#and-operator" id="toc-and-operator" class="nav-link" data-scroll-target="#and-operator">and operator: &amp;</a></li>
  <li><a href="#or-operator" id="toc-or-operator" class="nav-link" data-scroll-target="#or-operator">or operator: |</a></li>
  <li><a href="#and-versus-or" id="toc-and-versus-or" class="nav-link" data-scroll-target="#and-versus-or">&amp; (and) versus | (or)</a></li>
  <li><a href="#more-complex-queries" id="toc-more-complex-queries" class="nav-link" data-scroll-target="#more-complex-queries">More complex queries</a></li>
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2">Exercise 2</a></li>
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3">Exercise 3</a></li>
  <li><a href="#add-new-columns-with-mutate" id="toc-add-new-columns-with-mutate" class="nav-link" data-scroll-target="#add-new-columns-with-mutate">Add new columns with mutate()</a></li>
  <li><a href="#exercise-4" id="toc-exercise-4" class="nav-link" data-scroll-target="#exercise-4">Exercise 4</a></li>
  <li><a href="#count-the-number-of-rows-with-count" id="toc-count-the-number-of-rows-with-count" class="nav-link" data-scroll-target="#count-the-number-of-rows-with-count">Count the number of rows with count()</a></li>
  <li><a href="#exercise-5" id="toc-exercise-5" class="nav-link" data-scroll-target="#exercise-5">Exercise 5</a></li>
  <li><a href="#save-data" id="toc-save-data" class="nav-link" data-scroll-target="#save-data">Save data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Working with data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="summary">
<section id="questions" class="level2">
<h2 class="anchored" data-anchor-id="questions">Questions</h2>
<ul>
<li>How do you work with iNaturalist CSV data in R?</li>
</ul>
</section>
<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives">Objectives</h2>
<ul>
<li>Import CSV data into R.</li>
<li>Select rows and columns of data.frames.</li>
<li>Use pipes to link steps together into pipelines.</li>
<li>Create new data.frame columns using existing columns.</li>
<li>Export data to a CSV file.</li>
</ul>
</section>
</div>
<section id="coding-concepts" class="level2">
<h2 class="anchored" data-anchor-id="coding-concepts">Coding Concepts</h2>
<section id="file-paths" class="level3">
<h3 class="anchored" data-anchor-id="file-paths">File paths</h3>
<p>When we reference other files from an R script, we need to give R precise instructions on where those files are. We do that using something called a <strong>file path</strong>.</p>
<p>There are two kinds of paths: <strong>absolute</strong> and <strong>relative</strong>. Absolute paths are specific to a particular computer, whereas relative paths are relative to a certain folder. For instance an absolute path is “/Users/username/Documents/coding/CNC-coding-workshop/data/cleaned/cnc-los-angeles-observations.csv”, and relative path is “data/cleaned/cnc-los-angeles-observations.csv”.</p>
</section>
<section id="functions" class="level3">
<h3 class="anchored" data-anchor-id="functions">Functions</h3>
<p>Functions are predefined bits of code that automate more complicated actions. Arguments are values that we pass into a function, and the function does something to the values. A function can have one or more arguments. A function’s arguments come in a particular order, and if you put them in the correct order, you don’t need to name them. Executing a function is called <em>calling</em> or <em>running</em> the function.</p>
<p>R has built in functions. You can also write your own functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a function named save_contact. 1st argument is name, 2nd is email.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>save_contact <span class="ot">&lt;-</span> <span class="cf">function</span>(name, email){</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prints the arguments</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">'name:'</span>, name, <span class="st">' email:'</span>, email)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">TODO</span><span class="co">: check if name and email are present</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">TODO</span><span class="co">: check if email is valid</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">TODO</span><span class="co">: save the values to a database</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">TODO</span><span class="co">: return new contact</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># pass in the argument names and values in order</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">save_contact</span>(<span class="at">name=</span><span class="st">'Jane'</span>, <span class="at">email=</span><span class="st">'jane@user.com'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>name: Jane  email: jane@user.com</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pass in values in order</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save_contact</span>(<span class="st">'Jane'</span>, <span class="st">'jane@user.com'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>name: Jane  email: jane@user.com</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pass in the argument names and values out of order</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save_contact</span>(<span class="at">email=</span><span class="st">'jane@user.com'</span>, <span class="at">name=</span><span class="st">'Jane'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>name: Jane  email: jane@user.com</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pass in values out of order</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save_contact</span>(<span class="st">'jane@user.com'</span>, <span class="st">'Jane'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>name: jane@user.com  email: Jane</code></pre>
</div>
</div>
<p>Often times, a function will process the input and return a value. To store value so we can continue to work with it, we need to assign it to an object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>new_contact <span class="ot">&lt;-</span> <span class="fu">save_contact</span>(<span class="st">'Jane'</span>, <span class="st">'jane@user.com'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>name: Jane  email: jane@user.com</code></pre>
</div>
</div>
</section>
<section id="r-packages" class="level3">
<h3 class="anchored" data-anchor-id="r-packages">R packages</h3>
<p>R itself has many built-in functions, but we can access many more by loading other packages. <strong>R packages</strong> contain code, data, and documentation that people can download and install to add more functionality to R.</p>
<p>To install these packages, use <code>install.packages()</code> function from R. We pass in the package names as arguments. The name of the packages must be in quotes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install one package</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"readr"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># install multiple packages</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"readr"</span>, <span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"sf"</span>, <span class="st">"lubridate"</span>, <span class="st">"mapview"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>R will connect to the internet and download packages from servers that have R packages. R will then install the packages on your computer. The console window will show you the progress of the installation process.</p>
<p>In order to use a package, use <code>library()</code> function from R. We pass in the name of the package as an argument. Do not use quotes around the package name when using <code>library()</code>.</p>
<p>These are R packages we will use in this workshop.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr) <span class="co"># read and write tabular data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># manipulate data</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># create data visualizations</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># handle geospatial data</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># manipulate dates</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapview) <span class="co"># create interactive maps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Generally it is a good idea to list all the libraries that you will use in the script at the beginning of the script. You want to install the package to your computer once, and then load it with <code>library()</code> in each script where you need to use it.</p>
</section>
</section>
<section id="importing-inaturalist-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-inaturalist-data">Importing iNaturalist data</h2>
<p>A CSV of iNaturalist observations for City Nature Challenge Los Angeles from 2015 to 2024 is located at “data/cleaned/cnc-los-angeles-observations.csv”. We are going to read that CSV using R.</p>
<section id="reading-a-file" class="level3">
<h3 class="anchored" data-anchor-id="reading-a-file">Reading a file</h3>
<p>In order to analyze the iNaturalist csv, we need to load <strong>readr</strong>, <strong>lubridate</strong> and <strong>dplyr</strong> packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr) <span class="co"># read and write tabular data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># manipulate data</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># manipulate dates</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will use the <code>read_csv()</code> function from <strong>readr</strong> package to read the iNaturalist CSV. We will pass in a relative path to the CSV file as an argument for <code>read_csv()</code>.</p>
<p><code>read_csv()</code> will return the content of the file. In order for us access the data later on, we need to assign the content to an object called <code>inat_data</code>. Objects are displayed in the <strong>Environment</strong> panel. Double click on <code>inat_data</code> in <strong>Environment</strong> to see all the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/cleaned/cnc-los-angeles-observations.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Typing out paths can be error prone, so we can utilize a keyboard shortcut. Inside the parentheses of <code>read_csv()</code>, type out a pair of quotes and put your cursor between them. Then hit <kbd>Tab</kbd>. A small menu showing your folders and files should show up. You can use the <kbd>↑</kbd> and <kbd>↓</kbd> keys to move through the options, or start typing to narrow them down. You can hit <kbd>Enter</kbd> to select a file or folder, and hit <kbd>Tab</kbd> again to continue building the file path. This might take a bit of getting used to, but once you get the hang of it, it will speed up writing file paths and reduce the number of mistakes you make.</p>
</div>
</div>
<p>To learn more about a function, you can type a <code>?</code> in front of the name of the function, which will bring up the official documentation for that function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>?read_csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Function documentation is written by the authors of the functions, so they can vary pretty widely in their style and readability. The first section, <strong>Description</strong>, gives you a concise description of what the function does, but it may not always be enough. The <strong>Arguments</strong> section defines all the arguments for the function and is usually worth reading thoroughly. Finally, the <strong>Examples</strong> section at the end will often have some helpful examples that you can run to get a sense of what the function is doing.</p>
</section>
</section>
<section id="the-data.frame" class="level2">
<h2 class="anchored" data-anchor-id="the-data.frame">The data.frame</h2>
<p>read_csv returns a <strong>data.frame</strong>. A <strong>data.frame</strong> is the most common way that R represents tabular data (data with rows and columns).</p>
<p>We can view the first few rows with the <code>head()</code> function from R, and the last few rows with the <code>tail()</code> function from R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(inat_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 40
      id uuid  observed_on_string observed_on time_observed_at time_zone user_id
   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;              &lt;date&gt;      &lt;chr&gt;            &lt;chr&gt;       &lt;dbl&gt;
1 2.93e6 3a3a… 2016-04-14 12:25:… 2016-04-14  2016-04-14 19:2… Pacific …  151043
2 2.93e6 9796… Thu Apr 14 2016 1… 2016-04-14  2016-04-14 19:0… Pacific …   10814
3 2.93e6 75e2… 2016-04-14 12:15:… 2016-04-14  2016-04-14 19:1… Pacific …   80445
4 2.93e6 2d7e… 2016-04-14 12:18:… 2016-04-14  2016-04-14 19:1… Pacific …   80445
5 2.93e6 dfb4… 2016-04-14 12:19:… 2016-04-14  2016-04-14 19:1… Pacific …   80445
6 2.94e6 b640… Thu Apr 14 2016 1… 2016-04-14  2016-04-14 19:3… Pacific …  121033
# ℹ 33 more variables: user_login &lt;chr&gt;, user_name &lt;chr&gt;, created_at &lt;chr&gt;,
#   updated_at &lt;chr&gt;, quality_grade &lt;chr&gt;, license &lt;chr&gt;, url &lt;chr&gt;,
#   image_url &lt;chr&gt;, sound_url &lt;chr&gt;, tag_list &lt;chr&gt;, description &lt;chr&gt;,
#   num_identification_agreements &lt;dbl&gt;,
#   num_identification_disagreements &lt;dbl&gt;, captive_cultivated &lt;lgl&gt;,
#   oauth_application_id &lt;dbl&gt;, place_guess &lt;chr&gt;, latitude &lt;dbl&gt;,
#   longitude &lt;dbl&gt;, positional_accuracy &lt;dbl&gt;, private_place_guess &lt;lgl&gt;, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(inat_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 40
      id uuid  observed_on_string observed_on time_observed_at time_zone user_id
   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;              &lt;date&gt;      &lt;chr&gt;            &lt;chr&gt;       &lt;dbl&gt;
1 2.54e8 cbef… 2024-04-28 10:15:… 2024-04-28  2024-04-28 17:1… Pacific … 2834615
2 2.55e8 aa10… 2024/04/26 4:36 PM 2024-04-26  2024-04-26 23:3… Pacific … 5347031
3 2.55e8 3266… 2024/04/26 3:17 PM 2024-04-26  2024-04-26 22:1… Pacific … 5347031
4 2.55e8 56f9… 2024/04/26 3:16 PM 2024-04-26  2024-04-26 22:1… Pacific … 5347031
5 2.55e8 43fe… 2024/04/26 1:43 PM 2024-04-26  2024-04-26 20:4… Pacific … 5347031
6 2.55e8 f2a9… 2024/04/26 12:19 … 2024-04-26  2024-04-26 19:1… Pacific … 5347031
# ℹ 33 more variables: user_login &lt;chr&gt;, user_name &lt;chr&gt;, created_at &lt;chr&gt;,
#   updated_at &lt;chr&gt;, quality_grade &lt;chr&gt;, license &lt;chr&gt;, url &lt;chr&gt;,
#   image_url &lt;chr&gt;, sound_url &lt;chr&gt;, tag_list &lt;chr&gt;, description &lt;chr&gt;,
#   num_identification_agreements &lt;dbl&gt;,
#   num_identification_disagreements &lt;dbl&gt;, captive_cultivated &lt;lgl&gt;,
#   oauth_application_id &lt;dbl&gt;, place_guess &lt;chr&gt;, latitude &lt;dbl&gt;,
#   longitude &lt;dbl&gt;, positional_accuracy &lt;dbl&gt;, private_place_guess &lt;lgl&gt;, …</code></pre>
</div>
</div>
<p>Use <code>glimpse()</code> from <strong>dplyr</strong> to see a information about a data frame. Number of rows and columns. For each column, we see the name, data type (<strong>dbl</strong> for number, <strong>chr</strong> for character, <strong>lgl</strong> for logical (true, false), <strong>date</strong> for date), and the first few values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(inat_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 191,638
Columns: 40
$ id                               &lt;dbl&gt; 2931940, 2934641, 2934961, 2934980, 2…
$ uuid                             &lt;chr&gt; "3a3af9a9-62d3-4f65-8251-9ea4a20d6276…
$ observed_on_string               &lt;chr&gt; "2016-04-14 12:25:00 AM PDT", "Thu Ap…
$ observed_on                      &lt;date&gt; 2016-04-14, 2016-04-14, 2016-04-14, …
$ time_observed_at                 &lt;chr&gt; "2016-04-14 19:25:00 UTC", "2016-04-1…
$ time_zone                        &lt;chr&gt; "Pacific Time (US &amp; Canada)", "Pacifi…
$ user_id                          &lt;dbl&gt; 151043, 10814, 80445, 80445, 80445, 1…
$ user_login                       &lt;chr&gt; "msmorales", "smartrf", "cdegroof", "…
$ user_name                        &lt;chr&gt; "Michael Morales", "Richard Smart (he…
$ created_at                       &lt;chr&gt; "2016-04-14 07:28:36 UTC", "2016-04-1…
$ updated_at                       &lt;chr&gt; "2021-12-26 06:58:04 UTC", "2018-05-2…
$ quality_grade                    &lt;chr&gt; "research", "needs_id", "research", "…
$ license                          &lt;chr&gt; "CC-BY", "CC-BY-NC", NA, NA, NA, "CC-…
$ url                              &lt;chr&gt; "http://www.inaturalist.org/observati…
$ image_url                        &lt;chr&gt; "https://inaturalist-open-data.s3.ama…
$ sound_url                        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ tag_list                         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ description                      &lt;chr&gt; "Spotted on a the wall of a planter, …
$ num_identification_agreements    &lt;dbl&gt; 5, 2, 1, 2, 2, 1, 0, 1, 2, 1, 1, 2, 1…
$ num_identification_disagreements &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ captive_cultivated               &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FA…
$ oauth_application_id             &lt;dbl&gt; 2, 3, NA, NA, NA, 3, 3, NA, NA, NA, 3…
$ place_guess                      &lt;chr&gt; "Olive Lane Walk Pomona, CA 91768", "…
$ latitude                         &lt;dbl&gt; 34.05829, 34.01742, 34.13020, 34.1314…
$ longitude                        &lt;dbl&gt; -117.8219, -118.2892, -118.8226, -118…
$ positional_accuracy              &lt;dbl&gt; 4, 5, NA, NA, NA, NA, 17, 55, 55, 55,…
$ private_place_guess              &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ private_latitude                 &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ private_longitude                &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ public_positional_accuracy       &lt;dbl&gt; 4, 5, NA, NA, NA, NA, 17, 55, 55, 55,…
$ geoprivacy                       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ taxon_geoprivacy                 &lt;chr&gt; NA, NA, NA, "open", "open", NA, "open…
$ coordinates_obscured             &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FA…
$ positioning_method               &lt;chr&gt; "gps", NA, NA, NA, NA, NA, NA, NA, NA…
$ positioning_device               &lt;chr&gt; "gps", NA, NA, NA, NA, NA, NA, NA, NA…
$ species_guess                    &lt;chr&gt; "Garden Snail", "Oestroidea", "Califo…
$ scientific_name                  &lt;chr&gt; "Cornu aspersum", "Oestroidea", "Arph…
$ common_name                      &lt;chr&gt; "Garden Snail", "Bot Flies, Blow Flie…
$ iconic_taxon_name                &lt;chr&gt; "Mollusca", "Insecta", "Insecta", "Re…
$ taxon_id                         &lt;dbl&gt; 480298, 356157, 54247, 36100, 36204, …</code></pre>
</div>
</div>
<p>You can also use <code>names()</code> from R to see the fields in the data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(inat_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "id"                               "uuid"                            
 [3] "observed_on_string"               "observed_on"                     
 [5] "time_observed_at"                 "time_zone"                       
 [7] "user_id"                          "user_login"                      
 [9] "user_name"                        "created_at"                      
[11] "updated_at"                       "quality_grade"                   
[13] "license"                          "url"                             
[15] "image_url"                        "sound_url"                       
[17] "tag_list"                         "description"                     
[19] "num_identification_agreements"    "num_identification_disagreements"
[21] "captive_cultivated"               "oauth_application_id"            
[23] "place_guess"                      "latitude"                        
[25] "longitude"                        "positional_accuracy"             
[27] "private_place_guess"              "private_latitude"                
[29] "private_longitude"                "public_positional_accuracy"      
[31] "geoprivacy"                       "taxon_geoprivacy"                
[33] "coordinates_obscured"             "positioning_method"              
[35] "positioning_device"               "species_guess"                   
[37] "scientific_name"                  "common_name"                     
[39] "iconic_taxon_name"                "taxon_id"                        </code></pre>
</div>
</div>
</section>
<section id="manipulating-data" class="level2">
<h2 class="anchored" data-anchor-id="manipulating-data">Manipulating data</h2>
<p>One of the most important skills for working with data in R is the ability to manipulate, modify, and reshape data. The <strong>dplyr</strong> package provide a series of powerful functions for many common data manipulation tasks.</p>
<section id="select" class="level3">
<h3 class="anchored" data-anchor-id="select">select()</h3>
<p><code>select()</code> picks certain columns of a data.frame. To use the <code>select()</code> function, the first argument is the name of the data.frame, and the rest of the arguments are unquoted names of the columns you want.</p>
<p>iNaturalist CSV has 39 columns. We want four columns: <code>user_login</code>, <code>common_name</code>, <code>scientific_name</code>, <code>observed_on</code>. The columns are arranged in the order we specified inside <code>select()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(inat_data, user_login, common_name, scientific_name, observed_on)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 191,638 × 4
   user_login    common_name                         scientific_name observed_on
   &lt;chr&gt;         &lt;chr&gt;                               &lt;chr&gt;           &lt;date&gt;     
 1 msmorales     Garden Snail                        Cornu aspersum  2016-04-14 
 2 smartrf       Bot Flies, Blow Flies, and Allies   Oestroidea      2016-04-14 
 3 cdegroof      California Orange-winged Grasshopp… Arphia ramona   2016-04-14 
 4 cdegroof      Western Side-blotched Lizard        Uta stansburia… 2016-04-14 
 5 cdegroof      Western Fence Lizard                Sceloporus occ… 2016-04-14 
 6 ttempel       &lt;NA&gt;                                Coelocnemis     2016-04-14 
 7 bradrumble    House Sparrow                       Passer domesti… 2016-04-15 
 8 deedeeflower5 Amur Carp                           Cyprinus rubro… 2016-04-14 
 9 deedeeflower5 Red-eared Slider                    Trachemys scri… 2016-04-14 
10 deedeeflower5 Mallard                             Anas platyrhyn… 2016-04-14 
# ℹ 191,628 more rows</code></pre>
</div>
</div>
</section>
<section id="filter" class="level3">
<h3 class="anchored" data-anchor-id="filter">filter()</h3>
<p>The <code>filter()</code> function is used to select rows that meet certain criteria. To get all the rows where the value of <code>common_name</code> is equal to ‘Western Fence Lizard’, we would run the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(inat_data, common_name <span class="sc">==</span> <span class="st">'Western Fence Lizard'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,339 × 40
        id uuid        observed_on_string observed_on time_observed_at time_zone
     &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;              &lt;date&gt;      &lt;chr&gt;            &lt;chr&gt;    
 1 2934994 dfb4b75d-a… 2016-04-14 12:19:… 2016-04-14  2016-04-14 19:1… Pacific …
 2 2935263 0267005d-1… 2016-04-14         2016-04-14  &lt;NA&gt;             Pacific …
 3 2935420 32ea1d16-a… 2016-04-14         2016-04-14  &lt;NA&gt;             Pacific …
 4 2935748 7474a2d6-e… 2016-04-14 14:01:… 2016-04-14  2016-04-14 21:0… Pacific …
 5 2935965 3bfef122-d… Thu Apr 14 2016 1… 2016-04-14  2016-04-14 19:4… Pacific …
 6 2938607 cb1e276b-f… Thu Apr 14 2016 1… 2016-04-14  2016-04-14 23:3… Pacific …
 7 2940103 14905d89-e… 2016-04-15 9:31:3… 2016-04-15  2016-04-15 16:3… Pacific …
 8 2940838 89eaa4ca-5… Fri Apr 15 2016 1… 2016-04-15  2016-04-15 17:1… Pacific …
 9 2940848 67f9dd78-a… Fri Apr 15 2016 1… 2016-04-15  2016-04-15 17:1… Pacific …
10 2940855 64d8ac40-2… Fri Apr 15 2016 1… 2016-04-15  2016-04-15 17:4… Pacific …
# ℹ 3,329 more rows
# ℹ 34 more variables: user_id &lt;dbl&gt;, user_login &lt;chr&gt;, user_name &lt;chr&gt;,
#   created_at &lt;chr&gt;, updated_at &lt;chr&gt;, quality_grade &lt;chr&gt;, license &lt;chr&gt;,
#   url &lt;chr&gt;, image_url &lt;chr&gt;, sound_url &lt;chr&gt;, tag_list &lt;chr&gt;,
#   description &lt;chr&gt;, num_identification_agreements &lt;dbl&gt;,
#   num_identification_disagreements &lt;dbl&gt;, captive_cultivated &lt;lgl&gt;,
#   oauth_application_id &lt;dbl&gt;, place_guess &lt;chr&gt;, latitude &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>There are over 3000 observations for ‘Western Fence Lizard’.</p>
<p>The <code>==</code> sign means “is equal to”. Take note, there are two equal signs.</p>
<p>There are several other operators we can use: &gt; “greater than”, &gt;= “greater than or equal”, &lt; “less than”, &lt;= “less than or equal”, and != “not equal to”.</p>
</section>
<section id="the-pipe" class="level3">
<h3 class="anchored" data-anchor-id="the-pipe">The pipe: %&gt;%</h3>
<p>What happens if we want to select columns and filter rows?</p>
<p>We use the pipe operator (<code>%&gt;%</code>) to call multiple functions.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can insert <code>%&gt;%</code> by using the keyboard shortcut <kbd>Shift+Cmd+M</kbd> (Mac) or <kbd>Shift+Ctrl+M</kbd> (Windows).</p>
</div>
</div>
<p>Get <code>user_login</code>, <code>common_name</code>, <code>scientific_name</code>, <code>observed_on</code> for all observations where <code>common_name</code> is ‘Western Fence Lizard’. Use filter to select rows, then use select to select columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(common_name <span class="sc">==</span> <span class="st">'Western Fence Lizard'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, common_name, scientific_name, observed_on) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,339 × 4
   user_login    common_name          scientific_name         observed_on
   &lt;chr&gt;         &lt;chr&gt;                &lt;chr&gt;                   &lt;date&gt;     
 1 cdegroof      Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 2 deedeeflower5 Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 3 deedeeflower5 Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 4 cdegroof      Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 5 lchroman      Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 6 maiz          Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 7 kimssight     Western Fence Lizard Sceloporus occidentalis 2016-04-15 
 8 sarahwenner   Western Fence Lizard Sceloporus occidentalis 2016-04-15 
 9 sarahwenner   Western Fence Lizard Sceloporus occidentalis 2016-04-15 
10 sarahwenner   Western Fence Lizard Sceloporus occidentalis 2016-04-15 
# ℹ 3,329 more rows</code></pre>
</div>
</div>
<p>Pipe operator take the thing on the lefthand side and insert it as the first argument of the function on the righthand side. By putting each of our functions onto a new line, we can build a nice, readable pipeline. <code>inat_data</code> gets piped into a <code>filter()</code> function, and it comes out modified somewhat. The output from <code>filter()</code> then gets sent into the <code>select()</code> function, where it is further modified, and then the final product gets printed out to our console. It can also be helpful to think of <code>%&gt;%</code> as meaning “and then”.</p>
<p>If we want to store this final data frame as an object, we use an assignment arrow <code>&lt;-</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>lizard_data <span class="ot">&lt;-</span> inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(common_name <span class="sc">==</span> <span class="st">'Western Fence Lizard'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, common_name, scientific_name, observed_on) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sometimes the coordinates for iNaturalist observations are obscured. For instance, when the observation involves an endangered species, iNaturalist will automatically obscure the coordinates in order to protect the animal, plant, fungi. Sometimes people will choose to obscure their location when they are making observations so that other people will not know their exact location.</p>
<p>To access one column in a data frame, use <code>dataframe$column_name</code>. To get a count of number of values for one column, use <code>table()</code> function from R and pass in one column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(inat_data<span class="sc">$</span>coordinates_obscured)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 FALSE   TRUE 
176943  14695 </code></pre>
</div>
</div>
<p>176K coordinates are ok, 14K are obscured</p>
<p>Let’s get the observations where the coordinates are not obscured.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(coordinates_obscured <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, common_name, scientific_name, observed_on) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 176,943 × 4
   user_login    common_name                         scientific_name observed_on
   &lt;chr&gt;         &lt;chr&gt;                               &lt;chr&gt;           &lt;date&gt;     
 1 msmorales     Garden Snail                        Cornu aspersum  2016-04-14 
 2 smartrf       Bot Flies, Blow Flies, and Allies   Oestroidea      2016-04-14 
 3 cdegroof      California Orange-winged Grasshopp… Arphia ramona   2016-04-14 
 4 cdegroof      Western Side-blotched Lizard        Uta stansburia… 2016-04-14 
 5 cdegroof      Western Fence Lizard                Sceloporus occ… 2016-04-14 
 6 ttempel       &lt;NA&gt;                                Coelocnemis     2016-04-14 
 7 bradrumble    House Sparrow                       Passer domesti… 2016-04-15 
 8 deedeeflower5 Amur Carp                           Cyprinus rubro… 2016-04-14 
 9 deedeeflower5 Red-eared Slider                    Trachemys scri… 2016-04-14 
10 deedeeflower5 Mallard                             Anas platyrhyn… 2016-04-14 
# ℹ 176,933 more rows</code></pre>
</div>
</div>
<p>iNaturalist gives a quality grade to each observation. When researchers use iNaturalist data, they normally use research grade observations.</p>
<p>To see all the unique values for a column, use <code>unique()</code> function from R and pass in the column name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(inat_data<span class="sc">$</span>quality_grade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "research" "needs_id" "casual"  </code></pre>
</div>
</div>
<p>Let’s get the observations that are research grade.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(quality_grade <span class="sc">==</span> <span class="st">'research'</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, common_name, scientific_name, observed_on)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 107,456 × 4
   user_login    common_name                         scientific_name observed_on
   &lt;chr&gt;         &lt;chr&gt;                               &lt;chr&gt;           &lt;date&gt;     
 1 msmorales     Garden Snail                        Cornu aspersum  2016-04-14 
 2 cdegroof      California Orange-winged Grasshopp… Arphia ramona   2016-04-14 
 3 cdegroof      Western Side-blotched Lizard        Uta stansburia… 2016-04-14 
 4 cdegroof      Western Fence Lizard                Sceloporus occ… 2016-04-14 
 5 deedeeflower5 Red-eared Slider                    Trachemys scri… 2016-04-14 
 6 deedeeflower5 Mallard                             Anas platyrhyn… 2016-04-14 
 7 lchroman      Cactus Wren                         Campylorhynchu… 2016-04-14 
 8 deedeeflower5 Desert Cottontail                   Sylvilagus aud… 2016-04-14 
 9 deedeeflower5 Western Fence Lizard                Sceloporus occ… 2016-04-14 
10 deedeeflower5 Eastern Fox Squirrel                Sciurus niger   2016-04-14 
# ℹ 107,446 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="errors-in-code" class="level2">
<h2 class="anchored" data-anchor-id="errors-in-code">Errors in code</h2>
<p>We are writing instructions for the computer. If there is a typo, mispelling, pass in wrong arguments into functions, etc, the code will not work and we will see errors. R will display the errors in red. You need to fix the errors in order for the code to work.</p>
<p>typo: we used <code>%&gt;</code>, when it should be <code>%&gt;%</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>inat_data %<span class="sc">&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, observed_on, common_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Misspelled <code>user_logi</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_logi, observed_on, common_name) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>typo: we use <code>=</code>, when it should be <code>==</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="at">user_login =</span> <span class="st">'natureinla'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>typo: extra <code>)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, observed_on, common_name)<span class="er">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exercise-1" class="level2 exercise">
<h2 class="anchored" data-anchor-id="exercise-1">Exercise 1</h2>
<p>Get all your City Nature Challenge observations.</p>
<ul>
<li>Use <code>select()</code>, <code>filter()</code></li>
<li>The results should have <code>user_login</code> equal to your iNaturalist username</li>
<li>The results should have <code>user_login</code>, <code>observed_on</code>, <code>common_name</code>, <code>scientific_name</code> columns</li>
<li>save the results to <code>my_obs</code></li>
<li>click on <code>my_obs</code> in the Environment tab to see the results</li>
</ul>
<div class="answer">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>my_obs <span class="ot">&lt;-</span> inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(user_login <span class="sc">==</span> <span class="st">'natureinla'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, observed_on, common_name, scientific_name) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="and-operator" class="level2">
<h2 class="anchored" data-anchor-id="and-operator">and operator: &amp;</h2>
<p>When we want go get rows that match multiple criteria, we can use the and operator <code>&amp;</code></p>
<p>Let’s get all observations that are research grade and <code>common_name</code> is ‘Western Fence Lizard’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( common_name <span class="sc">==</span> <span class="st">'Western Fence Lizard'</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>         <span class="sc">&amp;</span> quality_grade <span class="sc">==</span> <span class="st">'research'</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, common_name, scientific_name, observed_on)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,314 × 4
   user_login    common_name          scientific_name         observed_on
   &lt;chr&gt;         &lt;chr&gt;                &lt;chr&gt;                   &lt;date&gt;     
 1 cdegroof      Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 2 deedeeflower5 Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 3 deedeeflower5 Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 4 cdegroof      Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 5 lchroman      Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 6 maiz          Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 7 kimssight     Western Fence Lizard Sceloporus occidentalis 2016-04-15 
 8 sarahwenner   Western Fence Lizard Sceloporus occidentalis 2016-04-15 
 9 sarahwenner   Western Fence Lizard Sceloporus occidentalis 2016-04-15 
10 sarahwenner   Western Fence Lizard Sceloporus occidentalis 2016-04-15 
# ℹ 3,304 more rows</code></pre>
</div>
</div>
<p>Let’s get observations where <code>user_login</code> is ‘natureinla’ and <code>common_name</code> is ‘Western Fence Lizard’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(user_login <span class="sc">==</span> <span class="st">'natureinla'</span> <span class="sc">&amp;</span> common_name <span class="sc">==</span> <span class="st">'Western Fence Lizard'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, common_name, scientific_name, observed_on) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 79 × 4
   user_login common_name          scientific_name         observed_on
   &lt;chr&gt;      &lt;chr&gt;                &lt;chr&gt;                   &lt;date&gt;     
 1 natureinla Western Fence Lizard Sceloporus occidentalis 2016-04-16 
 2 natureinla Western Fence Lizard Sceloporus occidentalis 2016-04-16 
 3 natureinla Western Fence Lizard Sceloporus occidentalis 2016-04-17 
 4 natureinla Western Fence Lizard Sceloporus occidentalis 2016-04-16 
 5 natureinla Western Fence Lizard Sceloporus occidentalis 2016-04-17 
 6 natureinla Western Fence Lizard Sceloporus occidentalis 2016-04-17 
 7 natureinla Western Fence Lizard Sceloporus occidentalis 2016-04-19 
 8 natureinla Western Fence Lizard Sceloporus occidentalis 2016-04-16 
 9 natureinla Western Fence Lizard Sceloporus occidentalis 2016-04-18 
10 natureinla Western Fence Lizard Sceloporus occidentalis 2016-04-16 
# ℹ 69 more rows</code></pre>
</div>
</div>
</section>
<section id="or-operator" class="level2">
<h2 class="anchored" data-anchor-id="or-operator">or operator: |</h2>
<p>When we want to get rows that match one or more criteria, we can use the or operator <code>|</code></p>
<p>Let’s get observations where <code>user_login</code> is ‘natureinla’ or <code>common_name</code> is ‘Western Fence Lizard’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(user_login <span class="sc">==</span> <span class="st">'natureinla'</span> <span class="sc">|</span> common_name <span class="sc">==</span> <span class="st">'Western Fence Lizard'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, common_name, scientific_name, observed_on) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,216 × 4
   user_login    common_name            scientific_name              observed_on
   &lt;chr&gt;         &lt;chr&gt;                  &lt;chr&gt;                        &lt;date&gt;     
 1 cdegroof      Western Fence Lizard   Sceloporus occidentalis      2016-04-14 
 2 deedeeflower5 Western Fence Lizard   Sceloporus occidentalis      2016-04-14 
 3 deedeeflower5 Western Fence Lizard   Sceloporus occidentalis      2016-04-14 
 4 natureinla    Red-eared Slider       Trachemys scripta elegans    2016-04-14 
 5 natureinla    Monarch                Danaus plexippus             2016-04-14 
 6 cdegroof      Western Fence Lizard   Sceloporus occidentalis      2016-04-14 
 7 natureinla    San Diego Gopher Snake Pituophis catenifer annecte… 2016-04-14 
 8 lchroman      Western Fence Lizard   Sceloporus occidentalis      2016-04-14 
 9 maiz          Western Fence Lizard   Sceloporus occidentalis      2016-04-14 
10 natureinla    California Towhee      Melozone crissalis           2016-04-14 
# ℹ 6,206 more rows</code></pre>
</div>
</div>
<p>Let’s get observations where <code>common_name</code> is ‘Western Fence Lizard’ or <code>common_name</code> is ‘Western Honey Bee’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(common_name <span class="sc">==</span> <span class="st">'Western Honey Bee'</span> <span class="sc">|</span> common_name <span class="sc">==</span> <span class="st">'Western Fence Lizard'</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, observed_on, common_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,399 × 3
   user_login    observed_on common_name         
   &lt;chr&gt;         &lt;date&gt;      &lt;chr&gt;               
 1 cdegroof      2016-04-14  Western Fence Lizard
 2 deedeeflower5 2016-04-14  Western Fence Lizard
 3 deedeeflower5 2016-04-14  Western Fence Lizard
 4 cdegroof      2016-04-14  Western Fence Lizard
 5 lchroman      2016-04-14  Western Fence Lizard
 6 smartrf       2016-04-14  Western Honey Bee   
 7 maiz          2016-04-14  Western Fence Lizard
 8 smartrf       2016-04-15  Western Honey Bee   
 9 kimssight     2016-04-15  Western Fence Lizard
10 catherineh    2016-04-15  Western Honey Bee   
# ℹ 5,389 more rows</code></pre>
</div>
</div>
</section>
<section id="and-versus-or" class="level2">
<h2 class="anchored" data-anchor-id="and-versus-or">&amp; (and) versus | (or)</h2>
<p>and queries: <code>filter(user_login == 'natureinla' &amp; common_name == 'Western Fence Lizard')</code></p>
<ul>
<li>all observations for ‘natureinla’ for ‘Western Fence Lizard’</li>
<li>79 rows</li>
</ul>
<p>or queries: <code>filter(user_login == 'natureinla' | common_name == 'Western Fence Lizard')</code></p>
<ul>
<li>all observations for ‘natureinla’ plus all observations for ‘Western Fence Lizard’</li>
<li>6,216 rows</li>
</ul>
</section>
<section id="more-complex-queries" class="level2">
<h2 class="anchored" data-anchor-id="more-complex-queries">More complex queries</h2>
<p>Sometimes we want to use both <code>and</code> <code>or</code> to select the rows. We want observations where user is ‘cdegroof’ or ‘deedeeflower5’, and species is ‘Western Fence Lizard’. You can use multiple filter statememts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>complex_query <span class="ot">&lt;-</span> inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(user_login <span class="sc">==</span> <span class="st">'cdegroof'</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>         <span class="sc">|</span> user_login <span class="sc">==</span> <span class="st">'deedeeflower5'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(common_name <span class="sc">==</span> <span class="st">'Western Fence Lizard'</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, common_name, scientific_name, observed_on)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>complex_query</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 4
   user_login    common_name          scientific_name         observed_on
   &lt;chr&gt;         &lt;chr&gt;                &lt;chr&gt;                   &lt;date&gt;     
 1 cdegroof      Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 2 deedeeflower5 Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 3 deedeeflower5 Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 4 cdegroof      Western Fence Lizard Sceloporus occidentalis 2016-04-14 
 5 cdegroof      Western Fence Lizard Sceloporus occidentalis 2016-04-16 
 6 cdegroof      Western Fence Lizard Sceloporus occidentalis 2016-04-16 
 7 cdegroof      Western Fence Lizard Sceloporus occidentalis 2016-04-16 
 8 cdegroof      Western Fence Lizard Sceloporus occidentalis 2016-04-17 
 9 cdegroof      Western Fence Lizard Sceloporus occidentalis 2016-04-17 
10 cdegroof      Western Fence Lizard Sceloporus occidentalis 2016-04-17 
# ℹ 23 more rows</code></pre>
</div>
</div>
<p>When making complex queries, you should check the results to make sure you wrote the query correctly. We can use <code>unique()</code> to check the column values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(complex_query<span class="sc">$</span>common_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Western Fence Lizard"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(complex_query<span class="sc">$</span>user_login)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "cdegroof"      "deedeeflower5"</code></pre>
</div>
</div>
</section>
<section id="exercise-2" class="level2 exercise">
<h2 class="anchored" data-anchor-id="exercise-2">Exercise 2</h2>
<p>Get all your CNC observations that are research grade</p>
<ul>
<li>Use <code>select()</code>, <code>filter()</code>, <code>&amp;</code></li>
<li>The results should have <code>user_login</code> equal to your iNaturalist username</li>
<li>The results should have <code>quality_grade</code> equal to research.</li>
<li>The results should have <code>user_login</code>, <code>observed_on</code>, <code>common_name</code>, <code>scientific_name</code> columns</li>
<li>save the results to <code>my_obs_2</code> object</li>
</ul>
<div class="answer">
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>my_obs_2 <span class="ot">&lt;-</span> inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(user_login <span class="sc">==</span> <span class="st">'natureinla'</span> <span class="sc">&amp;</span> quality_grade <span class="sc">==</span> <span class="st">'research'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, observed_on, common_name, scientific_name) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="exercise-3" class="level2 exercise">
<h2 class="anchored" data-anchor-id="exercise-3">Exercise 3</h2>
<p>Get all your observations for two species</p>
<ul>
<li>Use <code>select()</code>, <code>filter()</code> , <code>|</code></li>
<li>use <code>unique()</code> to see all common names from <code>my_obs</code></li>
<li>The results should have <code>user_login</code> equal to your iNaturalist username</li>
<li>The results should have <code>common_name</code> equal to two species</li>
<li>The results should have <code>user_login</code>, <code>observed_on</code>, <code>common_name</code>, <code>scientific_name</code> columns</li>
<li>save the results to <code>my_obs_3</code> object</li>
</ul>
<div class="answer">
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(my_obs<span class="sc">$</span>common_name)[<span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Red-eared Slider"       "Monarch"                "San Diego Gopher Snake"
 [4] "California Towhee"      "Cooper's Hawk"          "tropical milkweed"     
 [7] "Allen's Hummingbird"    "Northern Mockingbird"   "House Sparrow"         
[10] "Indian Peafowl"        </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>my_obs_3 <span class="ot">&lt;-</span> inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(user_login <span class="sc">==</span> <span class="st">'natureinla'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(common_name <span class="sc">==</span> <span class="st">'Red-eared Slider'</span> <span class="sc">|</span> common_name<span class="sc">==</span><span class="st">'Monarch'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, observed_on, common_name, scientific_name) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="add-new-columns-with-mutate" class="level2">
<h2 class="anchored" data-anchor-id="add-new-columns-with-mutate">Add new columns with mutate()</h2>
<p>Another common task is creating a new column based on values in existing columns. For example, we could add a new column for year.</p>
<p>Use <code>mutate()</code> from <strong>dplry</strong> to add a column. We pass in the name of the new column, and the value of the column.</p>
<p>Use <code>year()</code> from <strong>lubridate</strong> on a date column to get the year.</p>
<p>Let’s get <code>observed_on</code> for rows 10315 to 10325</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>(inat_data<span class="sc">$</span>observed_on)[<span class="dv">10315</span><span class="sc">:</span><span class="dv">10325</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "2016-04-15" "2016-04-15" "2016-04-18" "2016-04-16" "2017-04-14"
 [6] "2017-04-15" "2017-04-14" "2017-04-14" "2017-04-14" "2017-04-14"
[11] "2017-04-14"</code></pre>
</div>
</div>
<p>Let’s get use <code>year()</code> to get the year from <code>observed_on</code> for rows 10300 to 10320</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">year</span>(inat_data<span class="sc">$</span>observed_on)[<span class="dv">10315</span><span class="sc">:</span><span class="dv">10325</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 2016 2016 2016 2016 2017 2017 2017 2017 2017 2017 2017</code></pre>
</div>
</div>
<p>This code will add <code>year</code> column using the <code>year(observed_on)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(observed_on))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can click on <code>temp</code> in <strong>Environment</strong> tab to see the data frame with <code>year</code> column.</p>
<p>We can also use <code>table()</code> to get the number of observations per year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(temp<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 2016  2017  2018  2019  2020  2021  2022  2023  2024 
10392 17495 19164 34057 19524 22549 19597 26602 22258 </code></pre>
</div>
</div>
<p>Let’s get all observations for 2020.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(observed_on)) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19,524 × 41
         id uuid       observed_on_string observed_on time_observed_at time_zone
      &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;              &lt;date&gt;      &lt;chr&gt;            &lt;chr&gt;    
 1 43036512 04f242ca-… Fri Apr 24 2020 0… 2020-04-24  2020-04-24 07:0… Pacific …
 2 43036525 e555cd6e-… Fri Apr 24 2020 0… 2020-04-24  2020-04-24 07:0… Pacific …
 3 43036534 07254549-… Fri Apr 24 2020 0… 2020-04-24  2020-04-24 07:0… Pacific …
 4 43036755 e564c3b8-… Fri Apr 24 2020 0… 2020-04-24  2020-04-24 07:0… Pacific …
 5 43036856 f6c57cc7-… Fri Apr 24 2020 0… 2020-04-24  2020-04-24 07:0… Pacific …
 6 43036989 9ed78eb9-… Fri Apr 24 2020 0… 2020-04-24  2020-04-24 07:0… Pacific …
 7 43037041 eb136934-… Fri Apr 24 2020 0… 2020-04-24  2020-04-24 07:0… Pacific …
 8 43037308 7b6fa694-… Fri Apr 24 2020 0… 2020-04-24  2020-04-24 07:1… Pacific …
 9 43037581 f4617484-… Fri Apr 24 2020 0… 2020-04-24  2020-04-24 07:1… Pacific …
10 43037631 45d17fa9-… Fri Apr 24 2020 0… 2020-04-24  2020-04-24 07:1… Pacific …
# ℹ 19,514 more rows
# ℹ 35 more variables: user_id &lt;dbl&gt;, user_login &lt;chr&gt;, user_name &lt;chr&gt;,
#   created_at &lt;chr&gt;, updated_at &lt;chr&gt;, quality_grade &lt;chr&gt;, license &lt;chr&gt;,
#   url &lt;chr&gt;, image_url &lt;chr&gt;, sound_url &lt;chr&gt;, tag_list &lt;chr&gt;,
#   description &lt;chr&gt;, num_identification_agreements &lt;dbl&gt;,
#   num_identification_disagreements &lt;dbl&gt;, captive_cultivated &lt;lgl&gt;,
#   oauth_application_id &lt;dbl&gt;, place_guess &lt;chr&gt;, latitude &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section>
<section id="exercise-4" class="level2 exercise">
<h2 class="anchored" data-anchor-id="exercise-4">Exercise 4</h2>
<p>Get all of your observations from last year.</p>
<ul>
<li>Use <code>select()</code> and <code>filter()</code></li>
<li>Use <code>mutate()</code> and <code>year()</code> to add year column</li>
<li>The results should have <code>user_login</code> equal to your iNaturalist username</li>
<li>The results should have <code>year</code> equal last year</li>
<li>The results should have <code>user_login</code>, <code>observed_on</code>, <code>common-name</code>, <code>scientific_name</code>.</li>
</ul>
<div class="answer">
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(observed_on)) <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(user_login <span class="sc">==</span> <span class="st">'natureinla'</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2024</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_login, observed_on, common_name, scientific_name) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  user_login observed_on common_name                scientific_name             
  &lt;chr&gt;      &lt;date&gt;      &lt;chr&gt;                      &lt;chr&gt;                       
1 natureinla 2024-04-29  San Diego Alligator Lizard Elgaria multicarinata webbii</code></pre>
</div>
</div>
</div>
</section>
<section id="count-the-number-of-rows-with-count" class="level2">
<h2 class="anchored" data-anchor-id="count-the-number-of-rows-with-count">Count the number of rows with count()</h2>
<p>Use <code>count()</code> from <strong>dplyr</strong> to count the number of values for one or more columns. We pass in the column names as arguments to <code>count()</code></p>
<p>Let’s try counting of all observations by year. Use <code>mutate()</code> to add a year column. Use <code>count()</code> to count the number of observations for each year. By default, count will add a new column caled <code>n</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(observed_on)) <span class="sc">%&gt;%</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
   year     n
  &lt;dbl&gt; &lt;int&gt;
1  2016 10392
2  2017 17495
3  2018 19164
4  2019 34057
5  2020 19524
6  2021 22549
7  2022 19597
8  2023 26602
9  2024 22258</code></pre>
</div>
</div>
<p>We can specify the name of the count column by passing in <code>name</code> argument to <code>count()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(observed_on)) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year, <span class="at">name=</span><span class="st">'obs_count'</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
   year obs_count
  &lt;dbl&gt;     &lt;int&gt;
1  2016     10392
2  2017     17495
3  2018     19164
4  2019     34057
5  2020     19524
6  2021     22549
7  2022     19597
8  2023     26602
9  2024     22258</code></pre>
</div>
</div>
<p>Let’s count the number of observations for each species. We will pass in both ‘common_name’ and ‘scientific_name’ because some species don’t have a common_name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(common_name, scientific_name, <span class="at">name=</span><span class="st">'obs_count'</span>)   </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9,868 × 3
   common_name                             scientific_name        obs_count
   &lt;chr&gt;                                   &lt;chr&gt;                      &lt;int&gt;
 1 Abalone                                 Haliotis                       7
 2 Abbott's bushmallow                     Malacothamnus abbottii         1
 3 Abelias                                 Abelia                         1
 4 Abert's Thread-waisted Wasp             Ammophila aberti               3
 5 Abyssinian banana                       Ensete ventricosum             1
 6 Acacia Psyllid                          Acizzia uncatoides             2
 7 Acacias, Mimosas, mesquites, and allies Mimosoideae                   10
 8 Acalyptrate Flies                       Acalyptratae                  66
 9 Acanthus                                Acanthus                      23
10 Achilid Planthoppers                    Achilidae                      1
# ℹ 9,858 more rows</code></pre>
</div>
</div>
<p>It’s often useful to take a look at the results in some order, like the lowest count to highest. We can use the <code>arrange()</code> function from <strong>dplyr</strong> for that. We pass in the columns we want to order by to <code>arrange()</code>. By default, <code>arrange()</code> will return values from lowest to highest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(common_name, scientific_name, <span class="at">name=</span><span class="st">'obs_count'</span>)   <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(obs_count)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9,868 × 3
   common_name                     scientific_name         obs_count
   &lt;chr&gt;                           &lt;chr&gt;                       &lt;int&gt;
 1 Abbott's bushmallow             Malacothamnus abbottii          1
 2 Abelias                         Abelia                          1
 3 Abyssinian banana               Ensete ventricosum              1
 4 Achilid Planthoppers            Achilidae                       1
 5 Acorn Moth                      Blastobasis glandulella         1
 6 Acotylean Flatworms             Acotylea                        1
 7 Active Free-living Bristleworms Errantia                        1
 8 Afghan Tortoise                 Testudo horsfieldii             1
 9 African Clawed Frog             Xenopus laevis                  1
10 African Milk Weed               Euphorbia trigona               1
# ℹ 9,858 more rows</code></pre>
</div>
</div>
<p>If we want to reverse the order, we can wrap the column names in <code>desc()</code> from <strong>dplyr</strong>. This will return values from highest to lowest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(common_name, scientific_name, <span class="at">name=</span><span class="st">'obs_count'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(obs_count)) </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9,868 × 3
   common_name            scientific_name          obs_count
   &lt;chr&gt;                  &lt;chr&gt;                        &lt;int&gt;
 1 Western Fence Lizard   Sceloporus occidentalis       3339
 2 Western Honey Bee      Apis mellifera                2060
 3 dicots                 Magnoliopsida                 2012
 4 plants                 Plantae                       1715
 5 Eastern Fox Squirrel   Sciurus niger                 1475
 6 House Finch            Haemorhous mexicanus          1263
 7 Mourning Dove          Zenaida macroura              1205
 8 flowering plants       Angiospermae                  1162
 9 California poppy       Eschscholzia californica       934
10 Convergent Lady Beetle Hippodamia convergens          929
# ℹ 9,858 more rows</code></pre>
</div>
</div>
<p>use <code>slice()</code> from <strong>dplyr</strong> to return only certain number of records. <code>slice(start:end)</code> will return rows from the starting number to the ending number.</p>
<p>Let’s get the top ten species with the most observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(common_name, scientific_name, <span class="at">name=</span><span class="st">'obs_count'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(obs_count))  <span class="sc">%&gt;%</span> </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   common_name            scientific_name          obs_count
   &lt;chr&gt;                  &lt;chr&gt;                        &lt;int&gt;
 1 Western Fence Lizard   Sceloporus occidentalis       3339
 2 Western Honey Bee      Apis mellifera                2060
 3 dicots                 Magnoliopsida                 2012
 4 plants                 Plantae                       1715
 5 Eastern Fox Squirrel   Sciurus niger                 1475
 6 House Finch            Haemorhous mexicanus          1263
 7 Mourning Dove          Zenaida macroura              1205
 8 flowering plants       Angiospermae                  1162
 9 California poppy       Eschscholzia californica       934
10 Convergent Lady Beetle Hippodamia convergens          929</code></pre>
</div>
</div>
</section>
<section id="exercise-5" class="level2 exercise">
<h2 class="anchored" data-anchor-id="exercise-5">Exercise 5</h2>
<p>Get the number of observation you made per year</p>
<ul>
<li>Use <code>mutate()</code> and <code>year()</code> to add year column</li>
<li>Use <code>filter()</code> and <code>count()</code></li>
<li>The results should have <code>user_login</code> equal to your iNaturalist username</li>
<li>The results should have a year and count columns</li>
</ul>
<div class="answer">
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(observed_on)) <span class="sc">%&gt;%</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(user_login <span class="sc">==</span> <span class="st">'natureinla'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year, <span class="at">name=</span><span class="st">'obs_count'</span>)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 2
   year obs_count
  &lt;dbl&gt;     &lt;int&gt;
1  2016       930
2  2017      1055
3  2018       599
4  2019       350
5  2020        10
6  2021         2
7  2023         9
8  2024         1</code></pre>
</div>
</div>
</div>
</section>
<section id="save-data" class="level2">
<h2 class="anchored" data-anchor-id="save-data">Save data</h2>
<p>If you want to save your results, you can save the data frames as CSVs. First, assign the data frame to an object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>top_ten <span class="ot">&lt;-</span> inat_data <span class="sc">%&gt;%</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(common_name, scientific_name, <span class="at">name=</span><span class="st">'obs_count'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(obs_count))  <span class="sc">%&gt;%</span> </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>top_ten</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   common_name            scientific_name          obs_count
   &lt;chr&gt;                  &lt;chr&gt;                        &lt;int&gt;
 1 Western Fence Lizard   Sceloporus occidentalis       3339
 2 Western Honey Bee      Apis mellifera                2060
 3 dicots                 Magnoliopsida                 2012
 4 plants                 Plantae                       1715
 5 Eastern Fox Squirrel   Sciurus niger                 1475
 6 House Finch            Haemorhous mexicanus          1263
 7 Mourning Dove          Zenaida macroura              1205
 8 flowering plants       Angiospermae                  1162
 9 California poppy       Eschscholzia californica       934
10 Convergent Lady Beetle Hippodamia convergens          929</code></pre>
</div>
</div>
<p>Then <code>write_csv()</code> from <strong>dplyr</strong> to create a CSV. The first argument is the data frame to save. The second argument is the relative path of where to save the file. To keep our files organized, we are saving CSVs to the results folder. You should give the file a sensible name to help you remember what is in the file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(top_ten, <span class="st">'results/top_ten_observations.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>